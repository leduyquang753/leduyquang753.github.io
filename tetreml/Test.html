<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Tetreml â€“ UI test</title>
	</head>
	<body>
		<canvas id=mainWindow width=640 height=360 style="display: block; position: relative; margin: auto; z-index: 10; image-rendering: pixelated;"></canvas>
		<script src="Utils.js"></script>
		<script src="Controls.js"></script>
		<script defer>
			var mainWindow = document.getElementById("mainWindow");
			var ctx = mainWindow.getContext("2d");
			var currentGui = null;

			function openGui(gui) {
				if (currentGui != null) currentGui.close();
				currentGui = gui;
				if (currentGui != null) currentGui.init();
			}

			function goBack() {
				if (currentGui == null) return;
				openGui(currentGui.parent == undefined ? null : currentGui.parent);
			}

			openGui(new ControlsEditScreen(null, [
				[
					"General",
					["Pause", "Escape"],
					["Quit modifier", "KeyP"],
					["Volume down", "Minus"],
					["Volume up", "Equal"]
				],
				[
					"In-game",
					["Move left", "KeyA"],
					["Move right", "KeyD"],
					["Soft drop", "KeyS"],
					["Hard drop", "KeyW"],
					["Rotate counterclockwise", "KeyT"],
					["Rotate clockwise", "KeyY"],
					["Hold", "Space"],
					["Reset current tetrimino (sandbox)", "KeyR"]
				]
			], null));

			var isBusyRendering = false;

			function render() {
				requestAnimationFrame(render);
				if (!isBusyRendering) try {
					isBusyRendering = true;
					ctx.fillStyle = "#000";
					ctx.fillRect(0, 0, 640, 360);
					if (currentGui == null) return;
					currentGui.render();
				} finally {
					isBusyRendering = false;
				}
			}

requestAnimationFrame(render);
		</script>
	</body>
</html>